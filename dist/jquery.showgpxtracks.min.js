/*! jQuery Gpx Viewer - v0.2.0 - 2014-11-10
* Copyright (c) 2014 kssfilo; Licensed MIT */
!function(a){var b=function(b,c,d){var e=200,f=30,g=a('<div style="width:100%;height:70%">'),h=a('<canvas style="width:100%;height:20%">'),i=a('<div style="width:100%;height:10%;font-size:12px">');g.appendTo(b),h.appendTo(b),i.appendTo(b);var j=h[0].getContext("2d");h[0].width=h[0].offsetWidth,h[0].height=h[0].offsetHeight;var k=h[0].width-f,l=h[0].width;k=l;var m=h[0].height,n=new google.maps.Map(g[0]);n.setOptions({scrollwheel:!0,draggable:!0,panControl:!0,mapTypeId:google.maps.MapTypeId.HYBRID});for(var o=[],p=0,q=90,r=180,s=0,t=1e5,u=0,v=0,w=null,x=0,y=0,z=0;z<c.length;z++){z>0&&(c[z].ev=.9*c[z-1].ev+.1*c[z].ev),p=c[z].lt>p?c[z].lt:p,q=c[z].lt<q?c[z].lt:q,r=c[z].lg<r?c[z].lg:r,s=c[z].lg>s?c[z].lg:s,t=Math.min(c[z].ev,t),u=Math.max(c[z].ev,u);var A=new google.maps.LatLng(c[z].lt,c[z].lg);if(o.push(A),0!==z){var B=google.maps.geometry.spherical.computeDistanceBetween(A,w);v+=B,c[z].dt=v,c[z-1].ev<c[z].ev&&(x+=c[z].ev-c[z-1].ev),c[z-1].ev>c[z].ev&&(y+=c[z-1].ev-c[z].ev)}w=A}var C=u-t;C=Math.max(C,e);var D=new google.maps.Polyline({path:o,strokeColor:"#FF0000",strokeWeight:2,strokeOpacity:.9});D.setMap(n);var E=new google.maps.LatLngBounds(new google.maps.LatLng(q,r),new google.maps.LatLng(p,s));n.fitBounds(E);var F=k/v,G=m/C;for(j.fillStyle="white",j.fillRect(0,0,k,m),j.strokeStyle="lightgray",j.lineWidth=1,z=0;4>z;z++)j.beginPath(),j.moveTo(0,m/4*z),j.lineTo(k-1,m/4*z),j.closePath(),j.stroke();for(j.fillStyle="black",j.beginPath(),j.moveTo(k-1,m-1),j.lineTo(0,m-1),j.lineTo(0,m-1-(c[0].ev-t)*G),z=1;z<c.length;z++)j.lineTo(F*c[z].dt-1,m-1-G*(c[z].ev-t));j.lineTo(k-1,m-1),j.closePath(),j.fill(),j.strokeStyle="black",j.lineWidth=2,j.strokeRect(1,1,k-2,m-2),j.fillStyle="blue",j.textAlign="left",j.font="12px Ariel",j.shadowBlur=1,j.shadowColor="white",j.fillText("+"+Math.round(C)+"m",5,16),j.fillText(""+Math.round(t)+"m",5,m-6);var H="Distance:"+Math.round(v)/1e3+"km/Low:"+Math.round(t)+"m/High:"+Math.round(u)+"m/Accent:+"+Math.round(x)+"m/Descent:"+Math.round(y)+"m";d&&(H+="[<a href='"+d+"' download>Download GPX</a>]"),H+=" (c)<a href='http://kanasys.com/gtech/'>kanasys.com</a>",i.html(H)};a.fn.showGpxTracksString=function(c){this.each(function(){var d=this,e=a.parseXML(c),f=[];a(e).find("trkpt").each(function(){var b=new Date(a(this).find("time").text());f.push({lt:parseFloat(a(this).attr("lat")),lg:parseFloat(a(this).attr("lon")),ev:parseFloat(a(this).find("ele").text()),tm:b})}),b(d,f)})},a.fn.showGpxTracks=function(c){this.each(function(){function d(b,c){a.ajax({url:b,type:"GET",dataType:"xml",timeout:2e4,error:function(a){console.log(a)},success:function(d){var f=[];a(d).find("trkpt").each(function(){var b=new Date(a(this).find("time").text());f.push({lt:parseFloat(a(this).attr("lat")),lg:parseFloat(a(this).attr("lon")),ev:parseFloat(a(this).find("ele").text()),tm:b})}),f.length>1&&c(e,f,b)}})}var e=this,f=c;f||(f=a(this).attr("src")),f&&d(f,b)})}}(jQuery);